---
title: "Tutorial: Integrate your existing Android application with Microsoft identity platform for authentication"
description: In this tutorial, you integrate your existing Android application with Microsoft identity platform using Microsoft Authentication Library to sign in users and get an access token to call the Microsoft Graph API on their behalf.
author: negoe
manager: CelesteDG
ms.author: negoe
ms.date: 02/29/2024
ms.reviewer: dmwendia
ms.service: identity-platform

ms.topic: tutorial
#Customer intent: As an Android developer, I want to integrate the Microsoft Entra ID into my Android app, so that users can sign in with their personal Microsoft accounts or work/school accounts and access the Microsoft Graph API.
---
# Tutorial: Sign in users and call the Microsoft Graph API from an Android application

In this tutorial, you build an Android app that integrates with the Microsoft Entra ID to sign in users and get an access token to call the Microsoft Graph API.

When you've completed this tutorial, your application accepts sign-ins of personal Microsoft accounts (including outlook.com, live.com, and others) and work or school accounts from any company or organization that uses Microsoft Entra ID.

In this tutorial:

> [!div class="checklist"]
>
> - Register and configure your app in the Microsoft Entra admin center
> - Add code to support user sign-in and sign-out
> - Add code to call the Microsoft Graph API
> - Test the app

## Prerequisites

- Exsting [Android Studio](https://developer.android.com/studio)
- [Android documentation on generating a key](https://developer.android.com/studio/publish/app-signing#generate-key)
- 

## How this tutorial works

![Screenshot of how the sample app generated by this tutorial works.](./media/guidedsetup-android-intro/android-intro.svg)

The app in this tutorial signs in users and get data on their behalf. This data is accessed through a protected API (Microsoft Graph API) that requires authorization and is protected by the Microsoft identity platform.

This tutorial uses the Microsoft Authentication Library (MSAL) for Android to implement Authentication: [com.microsoft.identity.client](https://javadoc.io/doc/com.microsoft.identity.client/msal).



### Step 1: Register and configure your application with Microsoft Entra ID

[!INCLUDE [portal updates](~/includes/portal-update.md)]

1. To Reister and configure your app, download this PowerShell script. 
2. Run the powershell script from the same path as your code exist using 
   
### Step 2: Add MSAL and relevant dependencies to your project

1. In the Android Studio project window, navigate to **app** > **build.gradle** and add the following libraries in the _dependencies_ section:

   ```gradle
    implementation 'com.microsoft.identity.client:msal:5.0.0'
    implementation 'com.android.volley:volley:1.2.1'
   ```

1. In the Android Studio project window, open **settings.gradle** and declare the following maven repository in **dependencyResolutionManagement** > **repositories** section:

   ```gradle
    maven {
         url 'https://pkgs.dev.azure.com/MicrosoftDeviceSDK/DuoSDK-Public/_packaging/Duo-SDK-Feed/maven/v1'
    }
   ```

1. Select **Sync Now** in the notification bar.


### Step 3: Update your project to acquire a token  

1. Inside MainActivity.java, update the following code.
   
```java
private fun acquireToken(activity: Activity) {
        PublicClientApplication.createMultipleAccountPublicClientApplication(activity,
            R.raw.auth_config,
            object : IMultipleAccountApplicationCreatedListener {
                override fun onCreated(application: IMultipleAccountPublicClientApplication) {
                    val parameters: AcquireTokenParameters =
                        AcquireTokenParameters.Builder()
                            .startAuthorizationFromActivity(activity)
                            .fromAuthority("https://login.microsoftonline.com/common")
                            .withScopes(listOf("User.Read"))
                            .withCallback(object : AuthenticationCallback {
                                override fun onSuccess(authenticationResult: IAuthenticationResult) {
                                    updateUI("User: " + authenticationResult.account.username + "\n AT: " + authenticationResult.accessToken)
                                }
                                override fun onCancel() {
                                    updateUI("User cancelled login.")
                                }
                                override fun onError(e: MsalException) {
                                    updateUI("Error: " + e.message)
                                }
                            })
                            .build()

                    application.acquireToken(parameters)
                }

                override fun onError(exception: MsalException) {
                    updateUI("Error: " + exception.message)
                }
            })
    }

```
2. Update your UI and call the acquireToken function from you Sign-in button. 
   
```java
 Button(modifier = Modifier.fillMaxWidth(), onClick = { acquireToken(this@MainActivity) })
                        {
                            Text(text = "Sign in")
                        }
                        Text(output)
```
### Step 4: Call Graph API


### Step 4: Test Your application
 
### Step 5: Validate your updates

1. In Android Studio's project pane, navigate to **app\src\main\res\raw**.
2. In **app** > **src** > **main** > **res** > **raw**, you should find a file`auth_config_single_account.json`. 

   Your config file should resemble this example:

   ```json
   {
     "client_id": "your-app-id",
     "authorization_user_agent": "WEBVIEW",
     "redirect_uri": "msauth://<your-package-name>/<signing-key",
     "broker_redirect_uri_registered": true,
     "account_mode": "MULTIPLE",
     "authorities": [
       {
         "type": "AAD",
         "audience": {
           "type": "AzureADandPersonalMicrosoftAccount",
           "tenant_id": "common"
         }
       }
     ]
   }
   ```



### Customize your configuration
   As this tutorial only demonstrates how to configure a Multiple Account mode, see [single vs. multiple account mode](./single-multi-account.md) and [configuring your app](./msal-configuration.md) for more information

2. We recommend using 'WEBVIEW'. In case you want to configure  "authorization_user_agent" as 'BROWSER' in your app, you need make the following updates.
a) Update auth_config_single_account.json with  "authorization_user_agent": "Browser". 
b) Update AndroidManifest.xml. In the app go to **app** > **src** > **main** > **AndroidManifest.xml**, add the `BrowserTabActivity` activity as a child of the `<application>` element. This entry allows Microsoft Entra ID to call back to your application after it completes the authentication:

   ```xml
   <!--Intent filter to capture System Browser or Authenticator calling back to our app after sign-in-->
   <activity
       android:name="com.microsoft.identity.client.BrowserTabActivity"
       android:exported="true">
       <intent-filter>
           <action android:name="android.intent.action.VIEW" />
           <category android:name="android.intent.category.DEFAULT" />
           <category android:name="android.intent.category.BROWSABLE" />
           <data android:scheme="msauth"
               android:host="Enter_the_Package_Name"
               android:path="/Enter_the_Signature_Hash" />
       </intent-filter>
   </activity>
   ```

   - Use the **Package name** to replace `android:host=.` value. 
   - Use the **Signature Hash** to replace `android:path=` value. Ensure that there's a leading `/` at the beginning of your Signature Hash.
   You can find these values in the Authentication blade of your app registration as well.


